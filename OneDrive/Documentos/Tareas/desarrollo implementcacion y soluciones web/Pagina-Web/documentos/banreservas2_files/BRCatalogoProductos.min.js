



// products.js
document.addEventListener('DOMContentLoaded', () => {
    class ProductManager {
        constructor() {
            this.checkboxes = document.querySelectorAll('[data-interes]');
            this.products = document.querySelectorAll('div.row.product');
            this.searchInput = document.getElementById('txt-busqueda-product');
            this.searchButton = document.getElementById('btn-busqueda');
            this.applyFilterButton = document.getElementById('btn-products-list');
            this.clearFilterButton = document.getElementById('edit-reset');
            this.tabLinks = document.querySelectorAll('.tabs-link');

            this.initialize();
        }

        // Initialize the component
        initialize() {
            this.applyFilterButton.addEventListener('click', () => this.applyFilterAndSearch());
            this.searchButton.addEventListener('click', () => this.applyFilterAndSearch());
            this.clearFilterButton.addEventListener('click', () => this.clearFiltersAndSearch());

            this.tabLinks.forEach(tabLink => {
                tabLink.addEventListener('click', event => {
                    event.preventDefault();
                    this.changeActiveTab(event.currentTarget);
                    this.applyFilterAndSearch();
                });
            });

            this.countProductsByTab();
            this.initializePagination(Array.from(this.products));
        }

        // Model: Get selected interests
        getSelectedInterests() {
            return Array.from(this.checkboxes)
                .filter(checkbox => checkbox.checked)
                .map(checkbox => checkbox.getAttribute('data-interes').toLowerCase());
        }

        // Model: Get search text
        getSearchText() {
            return this.searchInput.value.toLowerCase();
        }

        // Model: Filter products based on interests, search text, and active tab
        filterProducts() {
            const selectedInterests = this.getSelectedInterests();
            const searchText = this.getSearchText();
            const activeTabData = document.querySelector('.tabs-link.active').getAttribute('data-tab').toLowerCase();

            return Array.from(this.products).filter(product => {
                const titleElement = product.querySelector('.title');
                const productCategory = product.getAttribute('data-content').toLowerCase();

                if (titleElement) {
                    const titleText = titleElement.textContent.toLowerCase();
                    const matchInterests = selectedInterests.some(interes => titleText.includes(interes));
                    const matchSearch = searchText === '' || titleText.includes(searchText);
                    const matchTab = activeTabData === 'todos' || productCategory === activeTabData;

                    return (selectedInterests.length === 0 || matchInterests) && matchSearch && matchTab;
                }
                return false;
            });
        }

        // View: Render products in the container
        renderProducts(data) {
            const productContainer = document.getElementById('products_results');
            productContainer.innerHTML = '';
            data.forEach(product => {
                productContainer.appendChild(product);
                product.style.display = 'block'; // Show only the paginated products
            });
        }

        // View: Update product count for each tab
        countProductsByTab() {
            this.tabLinks.forEach(tabLink => {
                const tabData = tabLink.getAttribute('data-tab').toLowerCase();
                const count = Array.from(this.products).filter(product => {
                    const productCategory = product.getAttribute('data-content').toLowerCase();
                    return productCategory === tabData || tabData === 'todos';
                }).length;

                tabLink.querySelector('span').textContent = tabData === 'todos' ? 'Todos' : `${tabLink.getAttribute('data-tab')} (${count})`;
            });
        }

        // View: Update product display
        updateProductDisplay(products) {
            $('#pagination-container').pagination({
                dataSource: products,
                pageSize: 5,
                callback: (data) => this.renderProducts(data),
            });
        }

        // Controller: Apply filters and search
        applyFilterAndSearch() {
            console.log('Applying filters and search...');
            const filteredProducts = this.filterProducts();
            this.updateProductDisplay(filteredProducts);
        }

        // Controller: Clear filters and search
        clearFiltersAndSearch() {
            this.checkboxes.forEach(checkbox => checkbox.checked = false);
            this.searchInput.value = '';
            this.updateProductDisplay(Array.from(this.products));
        }

        // Controller: Change active tab
        changeActiveTab(tabLink) {
            this.tabLinks.forEach(link => link.classList.remove('active'));
            tabLink.classList.add('active');
        }

        // Initialize pagination
        initializePagination(products) {
            $('#pagination-container').pagination({
                dataSource: products,
                pageSize: 5,
                callback: (data) => this.renderProducts(data),
            });
        }
    }

    // Instantiate the ProductManager
    new ProductManager();
});

document.addEventListener('DOMContentLoaded', () => {
    const landingProducts = document.querySelectorAll('div#products_results ul.product-list li.product-item');
    const tabLinks = document.querySelectorAll('.tabs-link');

    const productsByTab = (activeTab) => {
        const activeTabData = activeTab.getAttribute('data-tab').toLowerCase();

        landingProducts.forEach(ladProduct => {
            const landingProductData = ladProduct.getAttribute('data-content').toLowerCase();
            ladProduct.style.display = (activeTabData === 'todos' || activeTabData === landingProductData) ? 'block' : 'none';
        });

        const allHiddenLad = Array.from(landingProducts).every(landingProduct => landingProduct.style.display === 'none');
        if (allHiddenLad && activeTabData !== 'todos') {
            landingProducts.forEach(landingProduct => {
                landingProduct.style.display = 'none';
            });
        }
    };

    // Añadir evento de clic a cada enlace de pestaña
    tabLinks.forEach(tabLink => {
        tabLink.addEventListener('click', (event) => {
            event.preventDefault();

            tabLinks.forEach(link => link.classList.remove('active'));
            event.currentTarget.classList.add('active');

            productsByTab(event.currentTarget);
        });
    });

    // Muestra productos de la pestaña activa al cargar la página
    const activeTab = document.querySelector('.tabs-link.active');
    if (activeTab) {
        productsByTab(activeTab);
    }
});
